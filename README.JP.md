# rF2 Export Tools for Blender 4.0

rFactor2 用のカメラ、グリッド、ライト情報を Blender 4.0.2 からエクスポートするアドオンです。  
3つの機能を1つのアドオンとして統合しています。

---

## 目次

1. [インストール方法](#インストール方法)  
2. [それぞれのアドオンの使い方](#それぞれのアドオンの使い方)  
   - [2-1. ExportCameraの使い方](#2-1-exportcameraの使い方)  
   - [2-2. ExportGridの使い方](#2-2-exportgridの使い方)  
   - [2-3. ExportLightの使い方](#2-3-exportlightの使い方)  
3. [ライセンスについて](#ライセンスについて)  

---

## インストール方法

1. GitHub リポジトリのページから `Code` → `Download ZIP` をクリックしてZIPファイルをダウンロードします。  
2. Blenderを起動し、`Edit > Preferences > Add-ons > Install...` を選択します。  
3. ダウンロードしたZIPファイルを選択してインストールします（展開せずにそのまま指定してください）。  
4. `rF2 Export Tools` を有効化します。

---

## それぞれのアドオンの使い方

### 2-1. ExportCameraの使い方

- サイドバーの「rF2 tool」タブにある「Export camera」パネルから使用します。
- カメラオブジェクトを選択し、以下を設定：
  - `LOD multiplier`：LOD倍率
  - `Valid Paths`：Main や Pit に対応するチェック
  - `Groups`：カメラグループ（複数可）
  - `handle as movement`：可動カメラとして扱うか
  - `Movement Rate`：動作速度（可動カメラ時のみ）
- 必要に応じてネーミングヘルプも表示可能です。

#### ✅ 子オブジェクトの設定について（静的・可動共通）

- カメラの子オブジェクトとして **円オブジェクト（circle）** を配置してください。
  - これが `ActivationLocation` として出力されます。
- **可動カメラ（movement camera）** の場合はさらに以下が必要です：
  - カメラの子オブジェクトとして **長方形オブジェクト（Plane）** を複数配置してください。
  - これが `ControlPoint` として `MovementPath` に出力されます。

- `Export` ボタンを押すと `.txt` ファイルが出力されます。

---

### 2-2. ExportGridの使い方

- サイドバーの「rF2 tool」タブにある「Export Grid」パネルから使用します。
- `Add Triangle` ボタンを押すと、Z+方向を向いた三角形を追加できます。
- オブジェクト名に応じて自動的に分類され、座標・回転が rFactor2 用に変換されて出力されます。
- `Y Offset` を調整することで地面との埋まりを回避できます。

#### ✅ 三角形の向きについて

- 三角形の **頂点（尖った先端）が車両の進行方向を向くように** 正しい位置と回転で配置してください。

#### ⚠️ 注意点

- オブジェクト名の**最初の文字列**で分類が行われるため、
  - `grid`, `altgrid`, `pit`, `garage`, `teleport`, `aux`
  - などの文字列で始まる名前のオブジェクトが**他に存在すると、誤って処理される場合があります**。
- 該当する名前で始まるオブジェクトを**他目的に使わないでください**。

- `Export` ボタンで `.txt` ファイルが出力されます。

---

### 2-3. ExportLightの使い方

- サイドバーの「rF2 tool」タブにある「Export Light」パネルから使用します。
- Blenderシーン内の **ライトオブジェクト（特に Point Light）** をすべて取得し、rFactor2 形式で `.txt` に出力します。

#### ✅ パラメータ編集について

- ライトの以下のパラメータは **プロパティエディタの「データ」タブ**（ライトのアイコン）で設定してください：
  - **強さ（Energy）** → `Intensity` として出力されます
  - **色（Color）** → RGB値に変換されます（0–255）
  - **半径（Shadow Soft Size）** → `Range` の最大値として出力されます

- 出力ファイル名は自由に指定できますが、拡張子は `.txt` に強制されます。

---

## 共通の注意点（全エクスポート対象）

- オブジェクトは名前の末尾にある **番号（`.001`, `.002` など）** によって並び順が決まります。
- 番号の **数値が小さい順** にエクスポートされます。
- 名前に番号が**含まれていない場合**は、内部的に `.000` として扱われ、**最初に処理されます**。
- 正しい順序で出力されるよう、必ず `name`, `name.001`, `name.002` のように名前を統一してください。

---

## ライセンスについて

このアドオンは **GNU General Public License v3.0 (GPL-3.0)** に準拠しています。

- 自由に利用、改変、再配布が可能です。
- ソースコードを改変した場合は、同じライセンスでの公開が求められます。

詳しくは [GNU公式サイト](https://www.gnu.org/licenses/gpl-3.0.html) をご覧ください。

---
